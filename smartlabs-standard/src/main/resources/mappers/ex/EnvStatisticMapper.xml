<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.briup.smartlabs.mapper.ex.EnvStatisticMapper">
	<resultMap type="com.briup.smartlabs.bean.ex.EnvStatisticData" 
			   id="statisticMap">
		<result column="gd" property="gatherDate"/>	  
		<collection property="list" ofType="com.briup.smartlabs.bean.ex.EnvTypeDetail">
			<result column="type" property="type"/>
			<result column="val" property="value"/>
		</collection> 
	</resultMap>
	<select id="byMonth" resultMap="statisticMap">
		select date_format(gather_date,'%Y-%m-%d') gd,
			   type, avg(`value`) val
		from smart_env
		where DATE_FORMAT(gather_date,'%Y-%m') = #{date}
		group by type,DATE_FORMAT(gather_date,'%Y-%m-%d')
	</select>

	<select id="byYear" resultMap="statisticMap">
		select date_format(gather_date,'%Y-%m') gd,
			   type, avg(`value`) val
		from smart_env
		where DATE_FORMAT(gather_date,'%Y') = #{date}
		group by type,DATE_FORMAT(gather_date,'%Y-%m')
	</select>
</mapper>
